---
- name: Bootstrap Ansible Node
  hosts: BootStrap
  become: true
  tasks:
    - name: Add Docker group
      group:
        name: docker
        state: present
    - name: Add libvirt group
      group:
        name: libvirt
        state: present
    - name: SeLinuxPython [dnf]
      when: ansible_facts['distribution'] == "Fedora"
      dnf:
        name: libselinux-python
        state: latest
    - name: SeLinuxPython [yum]
      when: ansible_facts['os_family'] == "RedHat" and ansible_facts['distribution'] != "Fedora"
      become: true
      yum:
        name: libselinux-python
        state: latest
    - name: Add Ansible Local User
      user:
        name: Ansible-Local
        comment: Ansibles UserAccount
        password_lock: yes
        groups: docker,wheel,libvirt
        append: yes
        create_home: true
    - name: Make Ansible-Local Passwordless 
      lineinfile:
        path: /etc/sudoers
        state: present
        line: "Ansible-Local  ALL=(ALL)       NOPASSWD: ALL"
        validate: /usr/sbin/visudo -cf %s
    - name: "Make .ssh Key"   
      file:
        path: "/home/Ansible-Local/.ssh/"
        state: directory
        owner: Ansible-Local
        group: Ansible-Local
        mode: "0700"
    - name: Make Authorised Key
      become: true
      become_user: root      
      file:
        path: "/home/Ansible-Local/.ssh/authorized_keys"
        state: touch
        owner: Ansible-Local
        group: Ansible-Local
        mode: "0600"
    - name: Add Publickey
      lineinfile:
        path: "/home/Ansible-Local/.ssh/authorized_keys"
        line: "{{ ansibleLocalPubkey }}"
